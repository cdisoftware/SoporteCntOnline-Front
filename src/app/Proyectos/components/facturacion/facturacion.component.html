<div class="container">
    <h1 class="br tituloMod"><strong>Facturación Electronica</strong></h1>
    <br>
    <div class="row br justify-content-center">
        <div class="col-sm-2 text-center" (click)="ConsultaFactura()">
            <img src="../../../../assets/ImagenesSoporteTecntOnline/buscar.png" class="imagendetalle">
            <div>
                <label class="labelcont">Consultar factura</label>
            </div>
        </div>
        <div class="col-sm-2 text-center" (click)="GenXml()">
            <img src="../../../../assets/ImagenesSoporteTecntOnline/xml.png" class="imagendetalle">
            <div>
                <label class="labelcont">Generar xml</label>
            </div>
        </div>
        <div class="col-sm-2 text-center" (click)="HabilitarEmpresa()">
            <img src="../../../../assets/ImagenesSoporteTecntOnline/boton-actualizar.png" class="imagendetalle">
            <div>
                <label class="labelcont">Habilitar empresa facturación</label>
            </div>
        </div>
        <div class="col-sm-2 text-center" (click)="ActualizarDocumentacion()">
            <img src="../../../../assets/ImagenesSoporteTecntOnline/actualizarDocumentacion.png" class="imagendetalle">
            <div>
                <label class="labelcont">Actualizar documentación</label>
            </div>
        </div>
    </div>

    <!-- filtros generacion XML factura-->
    <div class="row br" *ngIf="verOcultarXML == true">
        <hr>
        <h6 class="tituloMod"><strong>Generar xml</strong></h6>
        <div class="row" (keyup.enter)="BuscarXML(ModalRespuesta)">
            <div class="col-sm-4">
                <input type="text" title="Regional" class="form-control form-control-sm textBox" placeholder="Regional"
                    [(ngModel)]="Reg">
            </div>
            <div class="col-sm-4">
                <input type="number" title="Número de factura" class="form-control form-control-sm textBox"
                    placeholder="Número de factura" [(ngModel)]="NumroFactura">
            </div>
            <!--
            <div class="col-sm-3">
                <select class="form-control form-control-sm textBox" title="Seleccionar tipo" [(ngModel)]="Tipo">
                    <option value="0" selected>Seleccione el tipo...</option>
                    <option value="fc"> fc </option>
                    <option value="nc"> nc </option>
                </select>
            </div>
            -->
            <div class="col-sm-4">
                <input type="text" title="Prefijo" class="form-control form-control-sm textBox" placeholder="Prefijo"
                    [(ngModel)]="Prefjo">
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-sm-3 col-12 br">
                <button class="col-sm-12 btn BtnPrincipal" title="Buscar plantilla"
                    (click)="BuscarXML(ModalRespuesta)">Buscar</button>
            </div>
            <div class="col-sm-3 col-12 br">
                <button class="col-sm-12 btn BtnCancel" title="Buscar plantilla" (click)="LimpiarXml()">Limpiar</button>
            </div>
        </div>

    </div>
    <!-- filtros busqueda factura-->
    <div class="row br" *ngIf="VerOcultarConsulta == true">
        <hr>
        <h6 class="tituloMod"><strong>Consulta Factura</strong></h6>
        <div class="row" (keyup.enter)="BuscarFactura()">
            <div class="col-sm-3">
                <input type="text" title="Nit empresa" class="form-control form-control-sm textBox"
                    placeholder="Nit empresa" [(ngModel)]="NitEmpresa">
            </div>
            <div class="col-sm-3">
                <input type="number" title="Número de factura" class="form-control form-control-sm textBox"
                    placeholder="Número de factura" [(ngModel)]="NumFactura">
            </div>
            <div class="col-sm-3">
                <input type="text" title="Regional" class="form-control form-control-sm textBox" placeholder="Regional"
                    [(ngModel)]="Regnal">
            </div>
            <div class="col-sm-3">
                <input type="text" title="Prefijo" class="form-control form-control-sm textBox" placeholder="Prefijo"
                    [(ngModel)]="Pfjo">
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-sm-3 col-12 br">
                <button class="col-sm-12 btn BtnPrincipal" title="Buscar plantilla"
                    (click)="BuscarFactura()">Buscar</button>
            </div>
            <div class="col-sm-3 col-12 br">
                <button class="col-sm-12 btn BtnCancel" title="Buscar plantilla"
                    (click)="LimpiarConsulta()">Limpiar</button>
            </div>
        </div>
    </div>

    <!-- formulario actualiza Facturacion-->
    <div class="row br" *ngIf="VerOcultarActualizar == true">
        <hr>
        <h6 class="tituloMod"><strong>Habilitar Empresa Facturación</strong></h6>
        <div class="row justify-content-center">
            <div class="row">
                <div class="col-sm-9" (keyup.enter)="BuscarHabilitarEmpresa()">
                    <input type="text" title="Nit empresa" class="form-control form-control-sm textBox"
                        placeholder="Nit empresa" [(ngModel)]="NitFact">
                </div>
                <div class="col-sm-3">
                    <button class="col-sm-12 btn BtnPrincipal" title="Buscar plantilla"
                        (click)="BuscarHabilitarEmpresa()">Buscar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- formulario Actualiza Facturacion-->
    <div class="row br" *ngIf="VerOcultarFormAct == true">
        <div class="row justify-content-center" *ngFor="let RespFact of arregloListaFactura">
            <div class="row">
                <div class="col-sm-6 br">
                    <label class="col-sm-6 Llave">Nit</label>
                    <input type="text" title="Nit" class="form-control form-control-sm textBox" disabled
                        placeholder="Nit" [(ngModel)]="RespFact.Nit">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Número resolución</label>
                    <input type="number" title="Número resolución" class="form-control form-control-sm textBox"
                        placeholder="Número resolución" [(ngModel)]="RespFact.NumResolucion">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Usuario</label>
                    <input type="text" title="Usuario" class="form-control form-control-sm textBox"
                        placeholder="Usuario" [(ngModel)]="RespFact.Usuario">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Contraseña</label>
                    <input type="text" title="Contraseña" class="form-control form-control-sm textBox"
                        placeholder="Contraseña" [(ngModel)]="RespFact.Contrasena">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Prefijo</label>
                    <input type="text" title="Prefijo" class="form-control form-control-sm textBox"
                        placeholder="Prefijo" [(ngModel)]="RespFact.Prefijo">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Prefijo nota credito</label>
                    <input type="text" title="Prefijo nota credito" class="form-control form-control-sm textBox"
                        placeholder="Prefijo nota credito" [(ngModel)]="RespFact.PrefijoNC">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Rango facturación desde</label>
                    <input type="number" class="form-control form-control-sm textBox"
                        placeholder="Rango facturación desde" [(ngModel)]="RespFact.RangoD">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Rango facturación hasta</label>
                    <input type="number" class="form-control form-control-sm textBox"
                        placeholder="Rango facturación hasta" [(ngModel)]="RespFact.RangoH">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Rango fecha facturación inicio</label>
                    <input type="date" title="Rango fecha inicio" class="form-control form-control-sm textBox"
                        placeholder="Rango fecha inicio" [(ngModel)]="RespFact.RangoFecIni">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Rango fecha facturación fin</label>
                    <input type="date" title="Rango fecha facturación fin" class="form-control form-control-sm textBox"
                        placeholder="Rango fecha facturación fin" [(ngModel)]="RespFact.RangoFecFin">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Rango nota credito desde</label>
                    <input type="number" title="Rango nota credito desde" class="form-control form-control-sm textBox"
                        placeholder="Rango nota credito desde" [(ngModel)]="RespFact.RangoNCD">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Rango nota credito hasta</label>
                    <input type="number" title="Rango nota credito hasta" class="form-control form-control-sm textBox"
                        placeholder="Rango nota credito hasta" [(ngModel)]="RespFact.RangoNCH">
                </div>
                <div class="col-sm-6 br">
                    <label class="col-sm-12 Llave">Nota crédito actual</label>
                    <input type="number" title="Nota crédito actual" class="form-control form-control-sm textBox"
                        placeholder="Rango nota credito hasta" [(ngModel)]="RespFact.NotaCreditoActual">
                </div>
            </div>
            <div class="row br justify-content-center">
                <div class="col-sm-3 col-12">
                    <button class="col-sm-12 btn BtnPrincipal"
                        (click)="GuardarHabilitarEmpresa(ModalRespuesta)">Guardar</button>
                </div>
                <div class="col-sm-3 col-12">
                    <button class="col-sm-12 btn BtnPrincipal" (click)="LimpiarFormularioAct()">Limpiar</button>
                </div>
                <div class="col-sm-3 col-12">
                    <button class="col-sm-12 btn BtnCancel" (click)="Cancelar()">Cancelar</button>
                </div>
            </div>
        </div>
    </div>
    <br>
    <!-- Tarjeta Factura-->
    <div class="row justify-content-center br tarjetadetalle"
        *ngFor="let factura of ArrayFactura | paginate: {itemsPerPage: 5, currentPage: page}">
        <div class="row m-2" *ngIf="VerOcultarCamposTarget == true">
            <div class="col-sm-12">
                <div class="row">
                    <div class="col-sm-4">
                        <label class="Llave">Número factura:&nbsp;</label><label
                            class="textblue"><strong>{{factura.NumeroFactura}}</strong></label>
                    </div>
                    <div class="col-sm-4">
                        <label class="Llave">Nit empresa:&nbsp;</label><label
                            class="Valor">{{factura.NitEmpresa}}</label>
                    </div>
                    <div class="col-sm-4">
                        <label class="Llave">Nit cliente:&nbsp;</label><label
                            class="Valor">{{factura.NitCliente}}</label>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-4">
                        <label class="Llave">Prefijo:&nbsp;</label><label class="Valor">{{factura.Prefijo}}</label>
                    </div>
                    <div class="col-sm-4">
                        <label class="Llave">Nombre cliente:&nbsp;</label><label
                            class="Valor">{{factura.NombreCliente}}</label>
                    </div>

                    <div class="col-sm-4">
                        <label class="Llave">Correo cliente:&nbsp;</label><label
                            class="Valor">{{factura.MailCliente}}</label>
                    </div>
                </div>

                <div class="row">
                    <div class="col-sm-4">
                        <label class="Llave">Fecha:&nbsp;</label><label class="Valor">{{factura.Fecha}}</label>
                    </div>
                    <div class="col-sm-8">
                        <label class="Llave">Observaciones:&nbsp;</label><label
                            class="Valor">{{factura.Observaciones}}</label>
                    </div>
                </div>
                <div class="" style="overflow: auto;">
                    <div class="br">
                        <label class="textblue col-sm-12">{{factura.Error}}</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row justify-content-center br tarjetadetalle" *ngIf="VerOcultarTargetXML == true">
        <div class="row">
            <div class="col-sm-12 br">
                <label class="col-sm-12 Llave">Resultado:</label>
                <textarea name="xml" #textAreaxml class="form-control form-control-sm textArea"
                    cols="30" rows="15" [(ngModel)]="Xml"></textarea>
            </div>
        </div>
        <div class="row justify-content-center">
            <div class="col-sm-12 text-center">
                <button type="button" class="col-sm-2 btn BtnPrincipal mt-2 mb-2" (click)="copiarXml(textAreaxml)">Copiar</button>
            </div>
        </div>
        <br>
    </div>
    <br>
    <!-- FORMULARIO CONSULTA ACTUALIZAR DOCUMENTOS -->
    <div class="row br" style="margin-top: -4px;" *ngIf="VerOcultarFormActu == true">
        <hr>
        <h6 class="tituloMod" style="margin-bottom: -100px;"><strong>Actualizar documentación</strong></h6>
        <div class="row g-3 justify-content-center">
            <div class="col-md-3 br">
                <input type="text" class="form-control textBox" title="Nit empresa" placeholder="Nit empresa" [(ngModel)]="NitEmpresa">
            </div>
            <div class="col-md-3 br">
                <input type="date" class="form-control textBox" title="Fecha inicio" min="1900-12-31" max="2999-12-31" [(ngModel)]="RangoFecIni">
            </div>
            <div class="col-md-3 br">
                <input type="date" class="form-control textBox" title="Fecha fin" min="1900-12-31" max="2999-12-31" [(ngModel)]="RangoFecFin">
            </div>
            <div class="col-md-3 br">
                <input type="text" class="form-control textBox" title="Numero factura" placeholder="Numero factura" [(ngModel)]="NumFactura">
            </div>
            <div class="col-md-6 text-md-end text-center">
                <button type="submit" class="btn btn-primary w-50 BtnPrincipal" (click)="ConsulActuDocu(ModalRespuesta)">Buscar</button>
            </div>
            <div class="col-md-6 text-md-start text-center">
                <button type="submit" class="btn btn-primary w-50 BtnCancel" (click)="LimpiarActuDocu()">Limpiar</button>
            </div>
        </div>
    </div>
    <!-- TABLA RESULTADO ACTUALIZAR DOCUMENTOS -->
    <div class="row mt-2 sinMp" *ngIf="VerOcultarResulActuDocu == true">
        <hr>
        <div class="col">
            <div class="table-responsive-sm table-bordered">
                <table class="table">
                    <tr>
                        <th scope="col" class="text-center">Numero factura</th>
                        <th scope="col" class="text-center">Nit empresa</th>
                        <th scope="col" class="text-center">Nombre</th>
                        <th scope="col" class="text-center">Email cliente</th>
                        <th scope="col" class="text-center">Nombre del cliente</th>
                        <th scope="col" class="text-center">Fecha</th>
                        <th scope="col" class="text-center">CUFE</th>
                        <th scope="col" class="text-center">Estado</th>
                        <th scope="col" class="text-center">Gen Doc</th>
                        <th scope="col" class="text-center">Num nota credito</th>
                        <th scope="col" class="text-center">Acciones</th>
                    </tr>
                    <tr *ngFor="let resulActDoc of ResulActuDocu">
                        <td scope="row" class="text-center">{{resulActDoc.NumeroFactura}}</td>
                        <td class="text-center">
                            <div style="overflow: auto; width: 200px;">{{resulActDoc.NitEmpresa}}</div>
                        </td>
                        <td class="text-center">{{resulActDoc.Nombre}}</td>
                        <td class="text-center">
                            <div style="overflow: auto; width:150px;">
                                {{resulActDoc.MailCliente}}
                            </div>
                        </td>
                        <td class="text-center">
                            <div style="overflow: auto; width:150px;">
                                {{resulActDoc.NombreCliente}}
                            </div>
                        </td>
                        <td class="text-center">{{resulActDoc.Fecha}}</td>
                        <td class="text-center">
                            <div style="overflow:auto; width: 200px;">
                                {{resulActDoc.CUFE}}
                            </div>
                        </td>
                        <td class="text-center">{{resulActDoc.Estado}}</td>
                        <td class="text-center">{{resulActDoc.GenDoc}}</td>
                        <td class="text-center">{{resulActDoc.NumNotaCredito}}</td>
                        <td *ngIf="resulActDoc.GenDoc == 1">
                            <div class="text-center">
                                <img src="../../../../assets/ImagenesSoporteTecntOnline/VerPdf.png" class="rounded img-fluid imagenDetalleTabla" alt="Boton PDF" (click)="AbrirAccionPdf(PopUpAccionPdf, PopUpErrorAcciones, resulActDoc.UrlPdf)">
                                <img src="../../../../assets/ImagenesSoporteTecntOnline/VerXml.png" class="rounded img-fluid imagenDetalleTabla" alt="Boton XML" (click)="AbrirAccionXml(PopUpAccionXml, PopUpErrorAcciones, resulActDoc.UrlXml)">
                            </div>
                        </td>
                        <td *ngIf="resulActDoc.GenDoc == 0">
                            <div class="text-center">
                                <img src="../../../../assets/ImagenesSoporteTecntOnline/boton-actualizar.png" class="rounded img-fluid imagenDetalleTabla" alt="Boton Actualizar" (click)="AbrirModalActualizar(PopUpActualizar, resulActDoc)">
                            </div>
                        </td>
                        <!-- MODAL ERROR 404 -->
                        <ng-template #PopUpErrorAcciones let-modal>
                            <div class="modal-header">
                                <img class="logoContabilidadOnl" src="../../../../assets/ImagenesSoporteTecntOnline/contabilidad.png">
                                <h1 class="modal-title">Error de Descarga</h1>
                                <button (keyup.enter)="modal.close()" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row br">
                                    <div class="col-sm-12">
                                        <h2 class="TituloDetalle">{{Respuesta}}</h2>
                                    </div>
                                    <br>
                                    <div class="col-sm-12 text-center">
                                        <button type="submit" class="btn btn-primary BtnCancel" style="width: 100px;" (click)="AbrirModalActualizar(PopUpActualizar, resulActDoc)">Actualizar</button>
                                    </div>
                                </div>
                            </div>
                            <div class="row justify-content-center">
                                <div class="col-sm-12 text-center">
                                    <button (keyup.enter)="modal.close()" type="button" class="col-sm-3 btn BtnPrincipal" (click)="modal.close()">Aceptar</button>
                                </div>
                            </div>
                            <br>
                        </ng-template>
                        <!-- MODAL ACTUALIZAR DOCUMENTACION -->
                        <ng-template #PopUpActualizar let-modal>
                            <div class="modal-header">
                                <img class="logoContabilidadOnl" src="../../../../assets/ImagenesSoporteTecntOnline/contabilidad.png">
                                <h1 class="modal-title">Actualizacion</h1>
                                <button (keyup.enter)="modal.close()" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
                            </div>
                            <div class="modal-body">
                                <div class="row br">
                                    <div class="col-sm-12">
                                        <h2 class="TituloDetalle">{{Respuesta}}</h2>
                                    </div>
                                </div>
                            </div>
                            <div class="row justify-content-center">
                                <div class="col-sm-12 text-center">
                                    <button (keyup.enter)="modal.close()" type="button" class="col-sm-3 btn BtnPrincipal" (click)="modal.dismiss()" (click)="CerraModal(PopUpErrorAcciones)">Aceptar</button>
                                </div>
                            </div>
                            <br>
                        </ng-template>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <div class="row text-center" *ngIf="verOcultarPge == true">
        <pagination-controls (pageChange)="page = $event" previousLabel="Anterior"
            nextLabel="Siguiente"></pagination-controls>
    </div>
    <div class="row br text-center" *ngIf="verOcultarLabel == true">
        <h2 class="textblue"><strong>¡ Sin resultados !</strong></h2>
        <h2 class="textblue"><strong>Revisa los datos de busqueda</strong></h2>
    </div>
</div>

<!-- Template Modal RESPUESTA-->
<ng-template #ModalRespuesta let-modal>
    <div class="modal-header">
        <img class="logoContabilidadOnl" src="../../../../assets/ImagenesSoporteTecntOnline/contabilidad.png">
        <h1>Respuesta</h1>
        <button (keyup.enter)="modal.close()" type="button" class="btn-close" aria-label="Close"
            (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
        <div class="row br">
            <div class="col-sm-12">
                <h2 class="TituloDetalle">{{Respuesta}}</h2>
            </div>
        </div>
    </div>
    <div class="row justify-content-center">
        <div class="col-sm-12 text-center">
            <button (keyup.enter)="modal.close()" type="button" class="col-sm-3 btn BtnPrincipal"
                (click)="modal.close()">Aceptar</button>
        </div>
    </div>
    <br>
</ng-template>
<!-- MODAL DESCARGA DE PDF -->
<ng-template #PopUpAccionPdf let-modal>
    <div class="modal-header">
        <img class="logoContabilidadOnl" src="../../../../assets/ImagenesSoporteTecntOnline/contabilidad.png">
        <h1 class="modal-title">Visualizacion PDF</h1>
        <button (keyup.enter)="modal.close()" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
        <div class="ratio ratio-1x1">
            <iframe [src]="EnlacePdf"></iframe>
        </div>
    </div>
    <div class="modal-footer">
    </div>
</ng-template>

<!-- MODAL DESCARGA DE XML -->
<ng-template #PopUpAccionXml let-modal>
    <div class="modal-header">
        <img class="logoContabilidadOnl" src="../../../../assets/ImagenesSoporteTecntOnline/contabilidad.png">
        <h1 class="modal-title">Visualizacion XML</h1>
        <button (keyup.enter)="modal.close()" type="button" class="btn-close" aria-label="Close" (click)="modal.dismiss()"></button>
    </div>
    <div class="modal-body">
        <div class="ratio ratio-1x1">
            <iframe [src]="EnlaceXml"></iframe>
        </div>
    </div>
    <div class="modal-footer">
    </div>
</ng-template>
